<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="xposed">
<meta property="og:type" content="article">
<meta property="og:title" content="xposed入门: FDex2源码分析与实战登山赛车">
<meta property="og:url" content="https://ixout.github.io/posts/32540/index.html">
<meta property="og:site_name" content="ixout&#39;s blog">
<meta property="og:description" content="xposed">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/ixout/ixout.github.io@main/img/2025-03-10_204742.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/ixout/ixout.github.io@main/img/2025-03-10_204718.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/ixout/ixout.github.io@main/img/2025-03-10_203953.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/ixout/ixout.github.io@main/img/2025-03-10_204311.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/ixout/ixout.github.io@main/img/2025-03-10_201903.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/ixout/ixout.github.io@main/img/2025-03-10_202207.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/ixout/ixout.github.io@main/img/2025-03-10_202526.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/ixout/ixout.github.io@main/img/2025-03-10_203509.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/ixout/ixout.github.io@main/img/2025-03-12_104718.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/ixout/ixout.github.io@main/img/2025-03-12_104949.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/ixout/ixout.github.io@main/img/2025-03-12_105901.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/ixout/ixout.github.io@main/img/2025-03-12_110418.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/ixout/ixout.github.io@main/img/2025-03-12_110541.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/ixout/ixout.github.io@main/img/2025-03-12_110839.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/ixout/ixout.github.io@main/img/2025-03-12_111012.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/ixout/ixout.github.io@main/img/2025-03-12_111153.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/ixout/ixout.github.io@main/img/2025-03-12_111524.png">
<meta property="article:published_time" content="2024-10-26T03:19:11.000Z">
<meta property="article:modified_time" content="2025-03-13T13:06:17.502Z">
<meta property="article:author" content="ixout">
<meta property="article:tag" content="xposed">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/ixout/ixout.github.io@main/img/2025-03-10_204742.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.png">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.png">
        
      
    
    <!-- title -->
    <title>xposed入门: FDex2源码分析与实战登山赛车</title>
    <!-- async scripts -->
    <!-- Google Analytics -->


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="ixout's blog" type="application/atom+xml">
</head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/posts/39380/"><i class="fa-solid fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post" href="/posts/44787/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://ixout.github.io/posts/32540/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://ixout.github.io/posts/32540/&text=xposed入门: FDex2源码分析与实战登山赛车"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://ixout.github.io/posts/32540/&title=xposed入门: FDex2源码分析与实战登山赛车"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://ixout.github.io/posts/32540/&is_video=false&description=xposed入门: FDex2源码分析与实战登山赛车"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=xposed入门: FDex2源码分析与实战登山赛车&body=Check out this article: https://ixout.github.io/posts/32540/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://ixout.github.io/posts/32540/&title=xposed入门: FDex2源码分析与实战登山赛车"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://ixout.github.io/posts/32540/&title=xposed入门: FDex2源码分析与实战登山赛车"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://ixout.github.io/posts/32540/&title=xposed入门: FDex2源码分析与实战登山赛车"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://ixout.github.io/posts/32540/&title=xposed入门: FDex2源码分析与实战登山赛车"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://ixout.github.io/posts/32540/&name=xposed入门: FDex2源码分析与实战登山赛车&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://ixout.github.io/posts/32540/&t=xposed入门: FDex2源码分析与实战登山赛车"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    
    
      <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%87%86%E5%A4%87"><span class="toc-number">1.</span> <span class="toc-text">准备</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#lsposed"><span class="toc-number">1.1.</span> <span class="toc-text">lsposed</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#magisk"><span class="toc-number">1.2.</span> <span class="toc-text">magisk</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#android-studio"><span class="toc-number">1.3.</span> <span class="toc-text">android studio</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%A8%A1%E5%9D%97init"><span class="toc-number">2.</span> <span class="toc-text">模块init</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%96%87%E6%A1%A3%E9%80%9F%E8%A7%88"><span class="toc-number">3.</span> <span class="toc-text">文档速览</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#XC-MethodHook"><span class="toc-number">3.1.</span> <span class="toc-text">XC_MethodHook</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#MethodHookParam"><span class="toc-number">3.1.1.</span> <span class="toc-text">MethodHookParam</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#XposedBridge"><span class="toc-number">3.2.</span> <span class="toc-text">XposedBridge</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#XposedHelper"><span class="toc-number">3.3.</span> <span class="toc-text">XposedHelper</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%A5%E5%8F%A3"><span class="toc-number">3.4.</span> <span class="toc-text">入口</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#IXposedHookLoadPackage"><span class="toc-number">3.4.1.</span> <span class="toc-text">IXposedHookLoadPackage</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IXposedHookInitPackageResources"><span class="toc-number">3.4.2.</span> <span class="toc-text">IXposedHookInitPackageResources</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IXposedHookZygoteInit"><span class="toc-number">3.4.3.</span> <span class="toc-text">IXposedHookZygoteInit</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E7%BB%84%E5%90%88"><span class="toc-number">3.4.4.</span> <span class="toc-text">接口组合</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#de-robv-android-xposed-callbacks"><span class="toc-number">3.5.</span> <span class="toc-text">de.robv.android.xposed.callbacks</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#de-robv-android-xposed-services"><span class="toc-number">3.6.</span> <span class="toc-text">de.robv.android.xposed.services</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%E5%88%86%E6%9E%90"><span class="toc-number">4.</span> <span class="toc-text">案例分析</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#FDex2%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90"><span class="toc-number">4.1.</span> <span class="toc-text">FDex2源码分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E6%88%98%E7%99%BB%E5%B1%B1%E8%B5%9B%E8%BD%A6"><span class="toc-number">4.2.</span> <span class="toc-text">实战登山赛车</span></a></li></ol></li></ol>
      </div>
    
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        xposed入门: FDex2源码分析与实战登山赛车
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">ixout</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2024-10-26T03:19:11.000Z" class="dt-published" itemprop="datePublished">2024-10-26</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fa-solid fa-archive"></i>
        <a class="category-link" href="/categories/android/">android</a>
    </div>


      
    <div class="article-tag">
        <i class="fa-solid fa-tag"></i>
        <a class="p-category" href="/tags/xposed/" rel="tag">xposed</a>
    </div>


    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <h1 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h1><h2 id="lsposed"><a href="#lsposed" class="headerlink" title="lsposed"></a>lsposed</h2><p>xposed仅支持到android 7.0版本, 在更高的版本有许多替代, 最常用的便是lsposed</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>特性</th>
<th>Xposed</th>
<th>LSPosed</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Hook 方式</strong></td>
<td>直接 Hook <code>Zygote</code> 进程</td>
<td>通过 Magisk / Riru 注入 <code>Zygote</code></td>
</tr>
<tr>
<td><strong>兼容性</strong></td>
<td>旧版 Android（7.0-10.0）</td>
<td>适用于 Android 8.0+</td>
</tr>
<tr>
<td><strong>模块管理</strong></td>
<td>需要 Xposed Installer</td>
<td>需要 LSPosed Manager</td>
</tr>
<tr>
<td><strong>性能影响</strong></td>
<td>修改系统 <code>Zygote</code>，易损坏</td>
<td>仅 Hook 选定进程，更稳定</td>
</tr>
<tr>
<td><strong>安全性</strong></td>
<td>易被检测（如 SafetyNet）</td>
<td>更隐蔽，适用于新版本 Android</td>
</tr>
</tbody>
</table>
</div>
<p>不过二者模块是几乎完全兼容的, 语法什么的都差不多</p>
<h2 id="magisk"><a href="#magisk" class="headerlink" title="magisk"></a>magisk</h2><p>lsposed需要magisk配合才能使用</p>
<h2 id="android-studio"><a href="#android-studio" class="headerlink" title="android studio"></a>android studio</h2><p>android开发必备</p>
<h1 id="模块init"><a href="#模块init" class="headerlink" title="模块init"></a>模块init</h1><ol>
<li><p>android studio创建一个新项目</p>
</li>
<li><p>在main目录下新增一个libs目录, 将XposedBridge.jar放入, 放入后右击选择<code>Add As Library</code>(注: 该依赖也可以通过在线导入)</p>
</li>
<li><p>到build.gradle中将上一步在dependencies对应产生的引入依赖语句中的<code>implementation</code> 改为 <code>compileOnly</code></p>
</li>
<li><p>在main目录下新增<code>assets</code>目录, 其中新建文件<code>xposed_init</code>, 添加一行内容<code>包名.xposed入口类名</code></p>
</li>
<li><p>在main目录下新增<code>/res/values</code>目录, 创建文件<code>arrays.xml</code>, 用于管理模块作用域</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">string-array</span> <span class="attr">name</span>=<span class="string">&quot;xposedscope&quot;</span> &gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 这里填写模块的作用域应用的包名，可以填多个。 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">item</span>&gt;</span>ceui.lisa.pixiv<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">item</span>&gt;</span>com.xjs.ehviewer<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">item</span>&gt;</span>com.picacomic.fregata<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">string-array</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p>修改<code>AndroidManifest.xml</code>在\<application>标签中新增内容</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">application</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- other information here --&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 表明这是一个xposed模块, xposed通过这个标识识别模块, 不得更改 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta-data</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:name</span>=<span class="string">&quot;xposedmodule&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:value</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">    	 <span class="comment">&lt;!-- 模块描述 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta-data</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:name</span>=<span class="string">&quot;xposeddescription&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:value</span>=<span class="string">&quot;Easy example which makes the status bar clock red and adds a smiley&quot;</span> /&gt;</span></span><br><span class="line">    	 <span class="comment">&lt;!-- 最低要求xposed版本, 根据导入的xposed版本填 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta-data</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:name</span>=<span class="string">&quot;xposedminversion&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:value</span>=<span class="string">&quot;82&quot;</span> /&gt;</span></span><br><span class="line">    	 <span class="comment">&lt;!-- 模块作用域 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta-data</span></span></span><br><span class="line"><span class="tag">        	<span class="attr">android:name</span>=<span class="string">&quot;xposedscope&quot;</span></span></span><br><span class="line"><span class="tag">        	<span class="attr">android:resource</span>=<span class="string">&quot;@array/xposedscope&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">application</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h1 id="文档速览"><a href="#文档速览" class="headerlink" title="文档速览"></a>文档速览</h1><p><a target="_blank" rel="noopener" href="https://api.xposed.info/">https://api.xposed.info/</a></p>
<p>快速过一遍文档中常用部分</p>
<h2 id="XC-MethodHook"><a href="#XC-MethodHook" class="headerlink" title="XC_MethodHook"></a>XC_MethodHook</h2><p>钩子回调类, 进行hook时一般需要创建该类的匿名子类</p>
<p><img src="https://cdn.jsdelivr.net/gh/ixout/ixout.github.io@main/img/2025-03-10_204742.png" alt=""></p>
<h3 id="MethodHookParam"><a href="#MethodHookParam" class="headerlink" title="MethodHookParam"></a>MethodHookParam</h3><p>封装关于方法调用的信息, 也就是回hook的参数</p>
<p><img src="https://cdn.jsdelivr.net/gh/ixout/ixout.github.io@main/img/2025-03-10_204718.png" alt=""></p>
<h2 id="XposedBridge"><a href="#XposedBridge" class="headerlink" title="XposedBridge"></a>XposedBridge</h2><p>提供与 Xposed 框架交互的核心方法</p>
<p><img src="https://cdn.jsdelivr.net/gh/ixout/ixout.github.io@main/img/2025-03-10_203953.png" alt=""></p>
<h2 id="XposedHelper"><a href="#XposedHelper" class="headerlink" title="XposedHelper"></a>XposedHelper</h2><p>提供一些实用方法，用于快速hook, 反射和动态操作类、方法、字段等</p>
<p><img src="https://cdn.jsdelivr.net/gh/ixout/ixout.github.io@main/img/2025-03-10_204311.png" alt=""></p>
<h2 id="入口"><a href="#入口" class="headerlink" title="入口"></a>入口</h2><p>Xposed/LSPosed 模块的<strong>入口类</strong>通常需要实现 <strong>Xposed 框架的接口</strong>，用于接收 Hook 事件并执行 Hook 逻辑, 对于一个模块至少应该实现一个该类接口</p>
<p>主要有四类接口</p>
<h3 id="IXposedHookLoadPackage"><a href="#IXposedHookLoadPackage" class="headerlink" title="IXposedHookLoadPackage"></a>IXposedHookLoadPackage</h3><p>用于监听应用的加载过程并hook</p>
<p><strong>重写方法</strong>: <code>handleLoadPackage</code></p>
<p><strong>参数</strong>:<code>XC_LoadPackage.LoadPackageParam</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/ixout/ixout.github.io@main/img/2025-03-10_201903.png" alt=""></p>
<p><strong>示例</strong></p>
<p>注意:当app内存在多个包时, 使用参数lpparam.packageName过滤也只能使用应用包名</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> de.robv.android.xposed.IXposedHookLoadPackage;</span><br><span class="line"><span class="keyword">import</span> de.robv.android.xposed.XC_LoadPackage;</span><br><span class="line"><span class="keyword">import</span> de.robv.android.xposed.XposedBridge;</span><br><span class="line"><span class="keyword">import</span> de.robv.android.xposed.XposedHelpers;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainHook</span> <span class="keyword">implements</span> <span class="title class_">IXposedHookLoadPackage</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleLoadPackage</span><span class="params">(XC_LoadPackage.LoadPackageParam lpparam)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="keyword">if</span> (!lpparam.packageName.equals(<span class="string">&quot;com.target.app&quot;</span>)) <span class="keyword">return</span>; <span class="comment">// 仅 Hook 目标应用</span></span><br><span class="line">        XposedBridge.log(<span class="string">&quot;Hooking: &quot;</span> + lpparam.packageName);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 示例：Hook getPackageName() 方法</span></span><br><span class="line">        XposedHelpers.findAndHookMethod(</span><br><span class="line">            <span class="string">&quot;android.app.Application&quot;</span>, lpparam.classLoader, <span class="string">&quot;getPackageName&quot;</span>,</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">XC_MethodHook</span>() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">afterHookedMethod</span><span class="params">(MethodHookParam param)</span> &#123;</span><br><span class="line">                    param.setResult(<span class="string">&quot;com.fake.package&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="IXposedHookInitPackageResources"><a href="#IXposedHookInitPackageResources" class="headerlink" title="IXposedHookInitPackageResources"></a>IXposedHookInitPackageResources</h3><p>监听资源加载并hook, 用于修改目标应用的 UI 资源，例如替换图片、修改文本等</p>
<p><strong>重写方法</strong>: <code>handleInitPackageResources</code></p>
<p><strong>参数</strong>:<code>XC_InitPackageResources.InitPackageResourcesParam</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/ixout/ixout.github.io@main/img/2025-03-10_202207.png" alt=""></p>
<p><strong>示例:</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> de.robv.android.xposed.IXposedHookInitPackageResources;</span><br><span class="line"><span class="keyword">import</span> de.robv.android.xposed.callbacks.XC_InitPackageResources;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ResourceHook</span> <span class="keyword">implements</span> <span class="title class_">IXposedHookInitPackageResources</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleInitPackageResources</span><span class="params">(XC_InitPackageResources.InitPackageResourcesParam resparam)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="keyword">if</span> (!resparam.packageName.equals(<span class="string">&quot;com.target.app&quot;</span>)) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 替换字符串资源（如修改 App 标题）</span></span><br><span class="line">        resparam.res.setReplacement(<span class="string">&quot;com.target.app&quot;</span>, <span class="string">&quot;string&quot;</span>, <span class="string">&quot;app_name&quot;</span>, <span class="string">&quot;Hooked App!&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 替换图片资源</span></span><br><span class="line">        resparam.res.setReplacement(<span class="string">&quot;com.target.app&quot;</span>, <span class="string">&quot;drawable&quot;</span>, <span class="string">&quot;app_icon&quot;</span>, XposedHelpers.findSystemClass(<span class="string">&quot;com.myhook.module.R.drawable.new_icon&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="IXposedHookZygoteInit"><a href="#IXposedHookZygoteInit" class="headerlink" title="IXposedHookZygoteInit"></a>IXposedHookZygoteInit</h3><p><strong>系统启动时</strong> 进行 Hook，影响所有应用</p>
<p><strong>重写方法</strong>:<code>initZygote</code></p>
<p><strong>参数</strong>:<code>StartupParam</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/ixout/ixout.github.io@main/img/2025-03-10_202526.png" alt=""></p>
<p><strong>示例</strong>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> de.robv.android.xposed.IXposedHookZygoteInit;</span><br><span class="line"><span class="keyword">import</span> de.robv.android.xposed.XposedBridge;</span><br><span class="line"><span class="keyword">import</span> de.robv.android.xposed.XposedHelpers;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ZygoteHook</span> <span class="keyword">implements</span> <span class="title class_">IXposedHookZygoteInit</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initZygote</span><span class="params">(StartupParam startupParam)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        XposedBridge.log(<span class="string">&quot;Zygote Hook Initialized!&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Hook 所有应用的 getDeviceId()</span></span><br><span class="line">        XposedHelpers.findAndHookMethod(</span><br><span class="line">            <span class="string">&quot;android.telephony.TelephonyManager&quot;</span>, <span class="literal">null</span>, <span class="string">&quot;getDeviceId&quot;</span>,</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">XC_MethodHook</span>() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">afterHookedMethod</span><span class="params">(MethodHookParam param)</span> &#123;</span><br><span class="line">                    param.setResult(<span class="string">&quot;000000000000000&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="接口组合"><a href="#接口组合" class="headerlink" title="接口组合"></a>接口组合</h3><p>在一个 Xposed 模块中，可以同时实现多个 Hook 接口，例如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> de.robv.android.xposed.*;</span><br><span class="line"><span class="keyword">import</span> de.robv.android.xposed.callbacks.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainHook</span> <span class="keyword">implements</span> <span class="title class_">IXposedHookLoadPackage</span>, IXposedHookInitPackageResources &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleLoadPackage</span><span class="params">(XC_LoadPackage.LoadPackageParam lpparam)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="keyword">if</span> (!lpparam.packageName.equals(<span class="string">&quot;com.target.app&quot;</span>)) <span class="keyword">return</span>;</span><br><span class="line">        XposedBridge.log(<span class="string">&quot;Hooking: &quot;</span> + lpparam.packageName);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// Hook getPackageName()</span></span><br><span class="line">        XposedHelpers.findAndHookMethod(<span class="string">&quot;android.app.Application&quot;</span>, lpparam.classLoader, <span class="string">&quot;getPackageName&quot;</span>,</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">XC_MethodHook</span>() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">afterHookedMethod</span><span class="params">(MethodHookParam param)</span> &#123;</span><br><span class="line">                    param.setResult(<span class="string">&quot;com.fake.package&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleInitPackageResources</span><span class="params">(XC_InitPackageResources.InitPackageResourcesParam resparam)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="keyword">if</span> (!resparam.packageName.equals(<span class="string">&quot;com.target.app&quot;</span>)) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 修改界面</span></span><br><span class="line">        resparam.res.setReplacement(<span class="string">&quot;com.target.app&quot;</span>, <span class="string">&quot;string&quot;</span>, <span class="string">&quot;app_name&quot;</span>, <span class="string">&quot;Hooked App!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="de-robv-android-xposed-callbacks"><a href="#de-robv-android-xposed-callbacks" class="headerlink" title="de.robv.android.xposed.callbacks"></a>de.robv.android.xposed.callbacks</h2><p>包含了 Xposed 框架中的回调接口和类，用于处理模块与框架之间的交互</p>
<h2 id="de-robv-android-xposed-services"><a href="#de-robv-android-xposed-services" class="headerlink" title="de.robv.android.xposed.services"></a>de.robv.android.xposed.services</h2><p>提供了与系统服务交互的工具类，通常用于读取文件、获取系统信息等操作</p>
<p>主要就是<code>BaseService</code>类</p>
<p><img src="https://cdn.jsdelivr.net/gh/ixout/ixout.github.io@main/img/2025-03-10_203509.png" alt=""></p>
<h1 id="案例分析"><a href="#案例分析" class="headerlink" title="案例分析"></a>案例分析</h1><h2 id="FDex2源码分析"><a href="#FDex2源码分析" class="headerlink" title="FDex2源码分析"></a>FDex2源码分析</h2><p>FDex2是早期针对整体加固的脱壳xposed模块, 其源码并不复杂</p>
<p>其依赖了android7.0以前的两个特殊方法<code>getDex</code>和<code>getBytes</code>(这两个方法在android8开始废弃)</p>
<p>android中java.lang.Class类有一个名为getDex的方法, 可以获得某一个类的Dex对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Dex <span class="title function_">getDex</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (dexCache == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dexCache.getDex();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Dex又有一个方法名为getBytes, 可以获取Dex对象的内存数据</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">byte</span>[] getBytes() &#123;</span><br><span class="line">        <span class="type">ByteBuffer</span> <span class="variable">data</span> <span class="operator">=</span> <span class="built_in">this</span>.data.duplicate(); <span class="comment">// positioned ByteBuffers aren&#x27;t thread safe</span></span><br><span class="line">        <span class="type">byte</span>[] result = <span class="keyword">new</span> <span class="title class_">byte</span>[data.capacity()];</span><br><span class="line">        data.position(<span class="number">0</span>);</span><br><span class="line">        data.get(result);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>FDex2首先就是通过反射获取这两个类的引用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initRefect</span><span class="params">()</span>&#123;</span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">           <span class="comment">// public byte[] getBytes()</span></span><br><span class="line">           Dex = Class.forName(<span class="string">&quot;com.android.dex.Dex&quot;</span>);</span><br><span class="line">           Dex_getBytes = Dex.getDeclaredMethod(<span class="string">&quot;getBytes&quot;</span>,<span class="literal">null</span>);</span><br><span class="line">           <span class="comment">// public Dex getDex()</span></span><br><span class="line">           getDex = Class.forName(<span class="string">&quot;java.lang.Class&quot;</span>).getDeclaredMethod(<span class="string">&quot;getDex&quot;</span>,<span class="literal">null</span>);</span><br><span class="line">       &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">           e.printStackTrace();</span><br><span class="line">       &#125; <span class="keyword">catch</span> (NoSuchMethodException e) &#123;</span><br><span class="line">           e.printStackTrace();</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>接着使用xposed对<code>java.lang.ClassLoader</code>的<code>loadClass</code>方法进行hook</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleLoadPackage</span><span class="params">(XC_LoadPackage.LoadPackageParam lpparam)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        initRefect();</span><br><span class="line">        XposedBridge.log(<span class="string">&quot;目标包名：&quot;</span>+ lpparam.packageName);</span><br><span class="line">        <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="string">&quot;java.lang.ClassLoader&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">str2</span> <span class="operator">=</span> <span class="string">&quot;loadClass&quot;</span>;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">String</span> <span class="variable">packagename</span> <span class="operator">=</span> <span class="string">&quot;com.jiongji.andriod.card&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//   protected Class&lt;?&gt; loadClass(String className, boolean resolve) throws ClassNotFoundException</span></span><br><span class="line">        <span class="keyword">if</span>(lpparam.packageName.equals(packagename))&#123;</span><br><span class="line">            <span class="comment">// public static Unhook findAndHookMethod(String var0, ClassLoader var1, String var2, Object... var3)</span></span><br><span class="line">            XposedHelpers.findAndHookMethod(str, lpparam.classLoader, str2, String.class, Boolean.TYPE, <span class="keyword">new</span> <span class="title class_">XC_MethodHook</span>() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">afterHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">                    <span class="built_in">super</span>.afterHookedMethod(param);</span><br><span class="line">                    <span class="comment">//获取hook函数返回类</span></span><br><span class="line">                    <span class="type">Class</span> <span class="variable">cls</span> <span class="operator">=</span> (Class) param.getResult();</span><br><span class="line">                    <span class="keyword">if</span>(cls == <span class="literal">null</span>)&#123;</span><br><span class="line">                        <span class="keyword">return</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> cls.getName();</span><br><span class="line">                    XposedBridge.log(<span class="string">&quot;当前类名：&quot;</span>+name);</span><br><span class="line">                    <span class="type">byte</span>[] bArr = (<span class="type">byte</span>[]) Dex_getBytes.invoke(getDex.invoke(cls,<span class="literal">null</span>)); <span class="comment">//Class.getDex().getBytes()</span></span><br><span class="line">                    <span class="keyword">if</span>(bArr == <span class="literal">null</span>) &#123;</span><br><span class="line">                        XposedBridge.log(<span class="string">&quot;数据为空，返回&quot;</span>);</span><br><span class="line">                        <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">                    &#125;</span><br><span class="line">                    XposedBridge.log(<span class="string">&quot;开始写数据&quot;</span>);</span><br><span class="line">                    <span class="type">String</span> <span class="variable">dex_path</span> <span class="operator">=</span> <span class="string">&quot;/data/data/&quot;</span>+packagename+<span class="string">&quot;/&quot;</span>+packagename+<span class="string">&quot;_&quot;</span>+bArr.length+<span class="string">&quot;.dex&quot;</span>;</span><br><span class="line">                    XposedBridge.log(dex_path);</span><br><span class="line">                    <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(dex_path);</span><br><span class="line">                    <span class="keyword">if</span>(file.exists())&#123;</span><br><span class="line">                        <span class="keyword">return</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    writeByte(bArr,file.getAbsolutePath());</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">beforeHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">                    <span class="built_in">super</span>.beforeHookedMethod(param);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>其入口是<code>IXposedHookLoadPackage</code>, 在应用加载时触发回调</p>
<p>之后使用方法<code>findAndHookMethod</code>进行hook, 该方法有2个重载</p>
<p>这里选择的是</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Unhook <span class="title function_">findAndHookMethod</span><span class="params">(</span></span><br><span class="line"><span class="params">    String className,          // 目标类的全限定名</span></span><br><span class="line"><span class="params">    ClassLoader classLoader,    // 目标类的类加载器</span></span><br><span class="line"><span class="params">    String methodName,         // 目标方法名</span></span><br><span class="line"><span class="params">    Object... parameterTypesAndCallback // 方法参数类型和回调</span></span><br><span class="line"><span class="params">)</span></span><br></pre></td></tr></table></figure>
<p>第四个参数是可变参数, 用于指定目标方法的<u>参数类型</u>和回调逻辑, 且参数类型的顺序必须与目标方法的签名一致(避免有重载的情况)</p>
<p>源码中就是hook <code>java.lang.ClassLoader</code>的<code>loadClass</code>方法</p>
<p>待其执行完毕后从返回值获取到加载得到的类, 并调用<code>getDex</code>方法和<code>getBytes</code>方法从而获取到对应的内存字节流并将其保存</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">writeByte</span><span class="params">(<span class="type">byte</span>[] bArr,String str)</span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">OutputStream</span> <span class="variable">outputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(str);</span><br><span class="line">            outputStream.write(bArr);</span><br><span class="line">            outputStream.close();</span><br><span class="line">        &#125;  <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            XposedBridge.log(<span class="string">&quot;文件写出失败&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个脚本完全也可以通过frida来实现</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">savedex</span>(<span class="params">dexbytes, dexpath</span>) &#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> <span class="title class_">File</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;java.io.File&quot;</span>);</span><br><span class="line">        <span class="keyword">var</span> <span class="title class_">FileOutputStream</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;java.io.FileOutputStream&quot;</span>);</span><br><span class="line">        <span class="keyword">var</span> fileobj = <span class="title class_">File</span>.$new(dexpath);</span><br><span class="line">        <span class="keyword">var</span> fileOutputStreamobj = <span class="title class_">FileOutputStream</span>.$new(fileobj);</span><br><span class="line">        fileOutputStreamobj.<span class="title function_">write</span>(dexbytes);</span><br><span class="line">        fileOutputStreamobj.<span class="title function_">close</span>();</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">warn</span>(<span class="string">&quot;[dumpdex] Dex saved to: &quot;</span> + dexpath);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fdex2</span>(<span class="params">classname</span>) &#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title class_">Java</span>.<span class="title function_">enumerateClassLoadersSync</span>().<span class="title function_">forEach</span>(<span class="keyword">function</span> (<span class="params">loader</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">var</span> <span class="title class_">ThisClass</span> = loader.<span class="title function_">loadClass</span>(classname);</span><br><span class="line">                <span class="keyword">if</span> (<span class="title class_">ThisClass</span>) &#123;</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;[dumpdex] Found class: &quot;</span> + classname + <span class="string">&quot; in loader: &quot;</span> + loader);</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">var</span> dexobj = <span class="title class_">ThisClass</span>.<span class="title function_">getDex</span>();</span><br><span class="line">                    <span class="keyword">if</span> (dexobj) &#123;</span><br><span class="line">                        <span class="keyword">var</span> dexbytearray = dexobj.<span class="title function_">getBytes</span>();</span><br><span class="line">                        <span class="keyword">if</span> (dexbytearray) &#123;</span><br><span class="line">                            <span class="keyword">var</span> savedexpath = <span class="string">&quot;/sdcard/&quot;</span> + classname.<span class="title function_">replace</span>(<span class="regexp">/\./g</span>, <span class="string">&quot;_&quot;</span>) + <span class="string">&quot;.dex&quot;</span>;</span><br><span class="line">                            <span class="title function_">savedex</span>(dexbytearray, savedexpath);</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                            <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;[dumpdex] Failed to get Dex bytes for class: &quot;</span> + classname);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;[dumpdex] Failed to get Dex object for class: &quot;</span> + classname);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;[dumpdex] Error while processing loader: &quot;</span> + loader + <span class="string">&quot;, error: &quot;</span> + e.<span class="property">message</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title function_">fdex2</span>(<span class="string">&quot;com.example.target.TargetClass&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="实战登山赛车"><a href="#实战登山赛车" class="headerlink" title="实战登山赛车"></a>实战登山赛车</h2><p>找款小游戏试试手, 登山赛车版本1.48.18, 没有加壳</p>
<p>游戏打开竟然要求实名</p>
<p><img src="https://cdn.jsdelivr.net/gh/ixout/ixout.github.io@main/img/2025-03-12_104718.png" alt=""></p>
<p>且该窗口无法关闭, 所以首先得想办法pass掉实名验证</p>
<p>jadx打开, 通过activity记录能够知道, 由<code>MyStartActivity</code>启动了<code>IDCheckDialog</code>进行验证</p>
<p>一开始的想法是hook点击确定后的doRidCheck函数</p>
<p><img src="https://cdn.jsdelivr.net/gh/ixout/ixout.github.io@main/img/2025-03-12_104949.png" alt=""></p>
<p>但发现这个函数怎么都hook不到, 但他的同级函数却可以被hook, 暂时搞不明白</p>
<p><img src="https://cdn.jsdelivr.net/gh/ixout/ixout.github.io@main/img/2025-03-12_105901.png" alt=""></p>
<p>发现只有当actAsIdVerifyActivity为true时才会进入验证过程, 其又依赖于loginActivityExists的返回值</p>
<p><code>private boolean actAsIdVerifyActivity = !loginActivityExists();</code></p>
<p>所以我们直接hook loginActivityExists的返回值为true</p>
<p>先使用frida尝试</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="title class_">MyStartActivity</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.mygamez.common.MyStartActivity&quot;</span>);</span><br><span class="line">    <span class="title class_">MyStartActivity</span>[<span class="string">&quot;loginActivityExists&quot;</span>].<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;MyStartActivity.loginActivityExists is called&quot;</span>);</span><br><span class="line">        <span class="keyword">let</span> result = <span class="variable language_">this</span>[<span class="string">&quot;loginActivityExists&quot;</span>]();</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;MyStartActivity.loginActivityExists result=&quot;</span> + result);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/ixout/ixout.github.io@main/img/2025-03-12_110418.png" alt=""></p>
<p>成功加载但显然后续还有其他检测, 通过关键字可以知道游戏检测到了我们是游客模式</p>
<p>在防沉迷类下找到这三个函数</p>
<p><img src="https://cdn.jsdelivr.net/gh/ixout/ixout.github.io@main/img/2025-03-12_110541.png" alt=""></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="title class_">MyStartActivity</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.mygamez.common.MyStartActivity&quot;</span>);</span><br><span class="line">    <span class="title class_">MyStartActivity</span>[<span class="string">&quot;loginActivityExists&quot;</span>].<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;MyStartActivity.loginActivityExists is called&quot;</span>);</span><br><span class="line">        <span class="keyword">let</span> result = <span class="variable language_">this</span>[<span class="string">&quot;loginActivityExists&quot;</span>]();</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;MyStartActivity.loginActivityExists result=&quot;</span> + result);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> <span class="title class_">AntiAddictionManagerInstance</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.mygamez.common.antiaddiction.AntiAddictionManager$AntiAddictionManagerInstance&quot;</span>);</span><br><span class="line">    <span class="title class_">AntiAddictionManagerInstance</span>[<span class="string">&quot;isGuestMode&quot;</span>].<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;AntiAddictionManagerInstance.isGuestMode is called&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">AntiAddictionManagerInstance</span>[<span class="string">&quot;getUserAge&quot;</span>].<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;AntiAddictionManagerInstance.getUserAge is called&quot;</span>);</span><br><span class="line">        <span class="keyword">let</span> result = <span class="variable language_">this</span>[<span class="string">&quot;getUserAge&quot;</span>]();</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;AntiAddictionManagerInstance.getUserAge result=&quot;</span> + result);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">20</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>之后就可以成功进入游戏, 尝试内购</p>
<p><img src="https://cdn.jsdelivr.net/gh/ixout/ixout.github.io@main/img/2025-03-12_110839.png" alt=""></p>
<p>提示需要安装微信, 通过字符串找到检测处</p>
<p><img src="https://cdn.jsdelivr.net/gh/ixout/ixout.github.io@main/img/2025-03-12_111012.png" alt=""></p>
<p>然后其调用处判断返回值是否是空串, 如果是则说明没有错误, 所以hook其返回值始终返回空</p>
<p>接着继续搜索购买失败, 找到对应关键处</p>
<p><img src="https://cdn.jsdelivr.net/gh/ixout/ixout.github.io@main/img/2025-03-12_111153.png" alt=""></p>
<p>可以知道只有getResultCode返回1时才是购买成功, hook其返回值</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="title class_">MyStartActivity</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.mygamez.common.MyStartActivity&quot;</span>);</span><br><span class="line">    <span class="title class_">MyStartActivity</span>[<span class="string">&quot;loginActivityExists&quot;</span>].<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;MyStartActivity.loginActivityExists is called&quot;</span>);</span><br><span class="line">        <span class="keyword">let</span> result = <span class="variable language_">this</span>[<span class="string">&quot;loginActivityExists&quot;</span>]();</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;MyStartActivity.loginActivityExists result=&quot;</span> + result);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> <span class="title class_">AntiAddictionManagerInstance</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.mygamez.common.antiaddiction.AntiAddictionManager$AntiAddictionManagerInstance&quot;</span>);</span><br><span class="line">    <span class="title class_">AntiAddictionManagerInstance</span>[<span class="string">&quot;isGuestMode&quot;</span>].<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;AntiAddictionManagerInstance.isGuestMode is called&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">AntiAddictionManagerInstance</span>[<span class="string">&quot;getUserAge&quot;</span>].<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;AntiAddictionManagerInstance.getUserAge is called&quot;</span>);</span><br><span class="line">        <span class="keyword">let</span> result = <span class="variable language_">this</span>[<span class="string">&quot;getUserAge&quot;</span>]();</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;AntiAddictionManagerInstance.getUserAge result=&quot;</span> + result);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">20</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">let</span> <span class="title class_">BillingWrapperWeChat</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.mygamez.billing.BillingWrapperWeChat&quot;</span>);</span><br><span class="line">    <span class="title class_">BillingWrapperWeChat</span>[<span class="string">&quot;checkIfOkToContinuePaymentPaymentSpecificRequirements&quot;</span>].<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;BillingWrapperWeChat.checkIfOkToContinuePaymentPaymentSpecificRequirements is called&quot;</span>);</span><br><span class="line">        <span class="keyword">let</span> result = <span class="variable language_">this</span>[<span class="string">&quot;checkIfOkToContinuePaymentPaymentSpecificRequirements&quot;</span>]();</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;BillingWrapperWeChat.checkIfOkToContinuePaymentPaymentSpecificRequirements result=&quot;</span> + result);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="title class_">BillingResult</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.mygamez.billing.BillingResult&quot;</span>);</span><br><span class="line">    <span class="title class_">BillingResult</span>[<span class="string">&quot;getResultCode&quot;</span>].<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;BillingResult.getResultCode is called&quot;</span>);</span><br><span class="line">        <span class="keyword">let</span> result = <span class="variable language_">this</span>[<span class="string">&quot;getResultCode&quot;</span>]();</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;BillingResult.getResultCode result=&quot;</span> + result);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>此时已经破解完成, 接下来将frida代码转为xposed</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.xposed;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> de.robv.android.xposed.IXposedHookLoadPackage;</span><br><span class="line"><span class="keyword">import</span> de.robv.android.xposed.XC_MethodHook;</span><br><span class="line"><span class="keyword">import</span> de.robv.android.xposed.XposedBridge;</span><br><span class="line"><span class="keyword">import</span> de.robv.android.xposed.XposedHelpers;</span><br><span class="line"><span class="keyword">import</span> de.robv.android.xposed.callbacks.XC_LoadPackage;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">main</span> <span class="keyword">implements</span> <span class="title class_">IXposedHookLoadPackage</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleLoadPackage</span><span class="params">(<span class="keyword">final</span> XC_LoadPackage.LoadPackageParam lpparam)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="keyword">if</span> (!lpparam.packageName.equals(<span class="string">&quot;com.fingersoft.hillclimb.noncmcc&quot;</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Hook MyStartActivity.loginActivityExists</span></span><br><span class="line">        XposedHelpers.findAndHookMethod(<span class="string">&quot;com.mygamez.common.MyStartActivity&quot;</span>, lpparam.classLoader, <span class="string">&quot;loginActivityExists&quot;</span>, <span class="keyword">new</span> <span class="title class_">XC_MethodHook</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">beforeHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">                XposedBridge.log(<span class="string">&quot;loginActivityExists is called&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">afterHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">                XposedBridge.log(<span class="string">&quot;loginActivityExists result=&quot;</span> + param.getResult());</span><br><span class="line">                param.setResult(<span class="literal">true</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Hook AntiAddictionManager$AntiAddictionManagerInstance.isGuestMode</span></span><br><span class="line">        XposedHelpers.findAndHookMethod(<span class="string">&quot;com.mygamez.common.antiaddiction.AntiAddictionManager$AntiAddictionManagerInstance&quot;</span>, lpparam.classLoader, <span class="string">&quot;isGuestMode&quot;</span>, <span class="keyword">new</span> <span class="title class_">XC_MethodHook</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">beforeHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">                XposedBridge.log(<span class="string">&quot;isGuestMode is called&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">afterHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">                param.setResult(<span class="literal">false</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Hook AntiAddictionManager$AntiAddictionManagerInstance.getUserAge</span></span><br><span class="line">        XposedHelpers.findAndHookMethod(<span class="string">&quot;com.mygamez.common.antiaddiction.AntiAddictionManager$AntiAddictionManagerInstance&quot;</span>, lpparam.classLoader, <span class="string">&quot;getUserAge&quot;</span>, <span class="keyword">new</span> <span class="title class_">XC_MethodHook</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">beforeHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">                XposedBridge.log(<span class="string">&quot;getUserAge is called&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">afterHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">                XposedBridge.log(<span class="string">&quot;getUserAge result=&quot;</span> + param.getResult());</span><br><span class="line">                param.setResult(<span class="number">20</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Hook BillingWrapperWeChat.checkIfOkToContinuePaymentPaymentSpecificRequirements</span></span><br><span class="line">        XposedHelpers.findAndHookMethod(<span class="string">&quot;com.mygamez.billing.BillingWrapperWeChat&quot;</span>, lpparam.classLoader, <span class="string">&quot;checkIfOkToContinuePaymentPaymentSpecificRequirements&quot;</span>, <span class="keyword">new</span> <span class="title class_">XC_MethodHook</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">beforeHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">                XposedBridge.log(<span class="string">&quot;checkIfOkToContinuePaymentPaymentSpecificRequirements is called&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">afterHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">                XposedBridge.log(<span class="string">&quot;checkIfOkToContinuePaymentPaymentSpecificRequirements result=&quot;</span> + param.getResult());</span><br><span class="line">                param.setResult(<span class="string">&quot;&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Hook BillingResult.getResultCode</span></span><br><span class="line">        XposedHelpers.findAndHookMethod(<span class="string">&quot;com.mygamez.billing.BillingResult&quot;</span>, lpparam.classLoader, <span class="string">&quot;getResultCode&quot;</span>, <span class="keyword">new</span> <span class="title class_">XC_MethodHook</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">beforeHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">                XposedBridge.log(<span class="string">&quot;getResultCode is called&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">afterHookedMethod</span><span class="params">(MethodHookParam param)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">                XposedBridge.log(<span class="string">&quot;getResultCode result=&quot;</span> + param.getResult());</span><br><span class="line">                param.setResult(<span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>安装并启用模块</p>
<p><img src="https://cdn.jsdelivr.net/gh/ixout/ixout.github.io@main/img/2025-03-12_111524.png" alt=""></p>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">Home</a></li>
        
          <li><a href="/about/">About</a></li>
        
          <li><a href="/archives/">Writing</a></li>
        
          <li><a href="/search/">Search</a></li>
        
      </ul>
    </div>

    
    
      <div id="toc-footer" style="display: none">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%87%86%E5%A4%87"><span class="toc-number">1.</span> <span class="toc-text">准备</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#lsposed"><span class="toc-number">1.1.</span> <span class="toc-text">lsposed</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#magisk"><span class="toc-number">1.2.</span> <span class="toc-text">magisk</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#android-studio"><span class="toc-number">1.3.</span> <span class="toc-text">android studio</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%A8%A1%E5%9D%97init"><span class="toc-number">2.</span> <span class="toc-text">模块init</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%96%87%E6%A1%A3%E9%80%9F%E8%A7%88"><span class="toc-number">3.</span> <span class="toc-text">文档速览</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#XC-MethodHook"><span class="toc-number">3.1.</span> <span class="toc-text">XC_MethodHook</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#MethodHookParam"><span class="toc-number">3.1.1.</span> <span class="toc-text">MethodHookParam</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#XposedBridge"><span class="toc-number">3.2.</span> <span class="toc-text">XposedBridge</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#XposedHelper"><span class="toc-number">3.3.</span> <span class="toc-text">XposedHelper</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%A5%E5%8F%A3"><span class="toc-number">3.4.</span> <span class="toc-text">入口</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#IXposedHookLoadPackage"><span class="toc-number">3.4.1.</span> <span class="toc-text">IXposedHookLoadPackage</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IXposedHookInitPackageResources"><span class="toc-number">3.4.2.</span> <span class="toc-text">IXposedHookInitPackageResources</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IXposedHookZygoteInit"><span class="toc-number">3.4.3.</span> <span class="toc-text">IXposedHookZygoteInit</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E7%BB%84%E5%90%88"><span class="toc-number">3.4.4.</span> <span class="toc-text">接口组合</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#de-robv-android-xposed-callbacks"><span class="toc-number">3.5.</span> <span class="toc-text">de.robv.android.xposed.callbacks</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#de-robv-android-xposed-services"><span class="toc-number">3.6.</span> <span class="toc-text">de.robv.android.xposed.services</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%E5%88%86%E6%9E%90"><span class="toc-number">4.</span> <span class="toc-text">案例分析</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#FDex2%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90"><span class="toc-number">4.1.</span> <span class="toc-text">FDex2源码分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E6%88%98%E7%99%BB%E5%B1%B1%E8%B5%9B%E8%BD%A6"><span class="toc-number">4.2.</span> <span class="toc-text">实战登山赛车</span></a></li></ol></li></ol>
      </div>
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://ixout.github.io/posts/32540/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://ixout.github.io/posts/32540/&text=xposed入门: FDex2源码分析与实战登山赛车"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://ixout.github.io/posts/32540/&title=xposed入门: FDex2源码分析与实战登山赛车"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://ixout.github.io/posts/32540/&is_video=false&description=xposed入门: FDex2源码分析与实战登山赛车"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=xposed入门: FDex2源码分析与实战登山赛车&body=Check out this article: https://ixout.github.io/posts/32540/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://ixout.github.io/posts/32540/&title=xposed入门: FDex2源码分析与实战登山赛车"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://ixout.github.io/posts/32540/&title=xposed入门: FDex2源码分析与实战登山赛车"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://ixout.github.io/posts/32540/&title=xposed入门: FDex2源码分析与实战登山赛车"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://ixout.github.io/posts/32540/&title=xposed入门: FDex2源码分析与实战登山赛车"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://ixout.github.io/posts/32540/&name=xposed入门: FDex2源码分析与实战登山赛车&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://ixout.github.io/posts/32540/&t=xposed入门: FDex2源码分析与实战登山赛车"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
          <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>
        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2023-2025
    ixout
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="/search/">Search</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

</body>
</html>
